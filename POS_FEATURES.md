# POS QR Code Scanning Features

## Overview

The POS (Point of Sale) scanning system allows staff to scan QR codes generated by attendees and redeem meals. The system integrates with Luma data and Firebase for comprehensive tracking.

## Key Features

### 1. QR Code Scanning

- **Camera Integration**: Uses device camera to scan QR codes
- **Real-time Processing**: Instantly processes scanned data
- **Sound Feedback**: Plays beep sound on successful scans

### 2. Luma Data Integration

- **Guest Verification**: Checks scanned emails against Luma guest list
- **Ticket Type Validation**: Determines food access based on ticket type
- **Check-in Status**: Shows whether guest has checked in to the event
- **Access Control**: Identifies Basic vs General access tickets

### 3. Firebase Data Storage

- **Scan Records**: Saves all scan attempts to Firebase
- **Email Tracking**: Tracks scan count per email (max 3 scans)
- **Timestamp Recording**: Records exact scan time
- **Audit Trail**: Maintains complete history of all scans

### 4. Scan Limits

- **3-Scan Limit**: Each email can be scanned up to 3 times
- **Automatic Blocking**: Prevents scans beyond the limit
- **Clear Feedback**: Shows current scan count (e.g., "Scan 2/3")

### 5. Real-time Statistics

- **Today's Scans**: Shows total scans for current day
- **Luma Verified**: Count of scans with verified Luma data
- **Recent Activity**: Displays last 10 scans with details

### 6. User Interface

- **Clean Design**: Modern, responsive interface
- **Status Indicators**: Visual feedback for scan results
- **Detailed Information**: Shows attendee details and Luma data
- **Scan History**: Recent scans with timestamps

## Technical Implementation

### Data Flow

1. **Scan QR Code** → Parse JSON data
2. **Check Luma Data** → Verify against local luma.json
3. **Validate Access** → Check ticket type and permissions
4. **Check Scan History** → Count previous scans for email
5. **Save to Firebase** → Record scan in mealScans collection
6. **Update UI** → Show results and statistics

### Firebase Collections

- **mealScans**: Stores all scan records with metadata
  - email: Attendee email address
  - attendeeName: Name from Luma data
  - scannedAt: ISO timestamp
  - lumaVerified: Boolean flag
  - scanCount: Current scan number (1-3)
  - qrData: Original QR code data

### Luma Integration

- **Local Data**: Uses public/luma.json for guest lookup
- **Email Matching**: Case-insensitive email comparison
- **Access Validation**: Determines food access based on ticket names
- **Status Checking**: Verifies approval status and check-in status

## Usage Instructions

### For Staff

1. Navigate to `/pos` page
2. Click "Start Scanning" button
3. Allow camera access when prompted
4. Point camera at attendee's QR code
5. Review scan results and attendee information
6. Click "Scan Another" to continue

### For Attendees

1. Navigate to main page
2. Enter email address
3. Generate QR code
4. Show QR code to staff for scanning

## Error Handling

- **Invalid QR Codes**: Shows error message for malformed data
- **Network Issues**: Graceful handling of Firebase connection problems
- **Camera Access**: Clear instructions for camera permissions
- **Scan Limits**: Informative messages when limit is reached

## Security Features

- **Email Validation**: Ensures valid email format
- **Scan Tracking**: Prevents abuse through scan counting
- **Data Verification**: Cross-references with Luma data
- **Audit Trail**: Complete logging of all activities
