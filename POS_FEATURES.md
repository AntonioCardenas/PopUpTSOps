# POS Drinks QR Code Scanning Features

## Overview

The POS (Point of Sale) scanning system allows staff to scan QR codes generated by attendees and redeem drinks. The system integrates with Luma event data and Firebase for comprehensive tracking of drink redemptions.

## Key Features

### 1. QR Code Scanning

- **Camera Integration**: Uses device camera to scan QR codes
- **Real-time Processing**: Instantly processes scanned data
- **Sound Feedback**: Plays beep sound on successful scans

### 2. Luma Event Integration

- **Guest Verification**: Checks scanned emails against Luma event guest list
- **Event Validation**: Ensures guest is registered for the event
- **Check-in Status**: Shows whether guest has checked in to the event
- **Ticket Information**: Displays ticket type and approval status

### 3. Firebase Data Storage

- **Drink Records**: Saves all drink redemption attempts to Firebase
- **Email Tracking**: Tracks drink count per email (max 3 drinks)
- **Timestamp Recording**: Records exact redemption time
- **Audit Trail**: Maintains complete history of all drink redemptions

### 4. Drink Limits

- **3-Drink Limit**: Each email can redeem up to 3 drinks
- **Automatic Blocking**: Prevents redemptions beyond the limit
- **Clear Feedback**: Shows remaining drinks count (e.g., "2 drinks remaining")

### 5. Real-time Statistics

- **Today's Drinks**: Shows total drink redemptions for current day
- **Luma Verified**: Count of redemptions with verified Luma data
- **Recent Activity**: Displays last 10 drink redemptions with details

### 6. User Interface

- **Clean Design**: Modern, responsive interface
- **Status Indicators**: Visual feedback for redemption results
- **Detailed Information**: Shows guest details and event data
- **Drink History**: Recent redemptions with timestamps and remaining counts

## Technical Implementation

### Data Flow

1. **Scan QR Code** → Parse JSON data
2. **Check Luma Data** → Verify against local luma.json
3. **Validate Guest** → Ensure guest is registered for event
4. **Check Drink History** → Count previous redemptions for email
5. **Save to Firebase** → Record redemption in drinksScans collection
6. **Update UI** → Show results and remaining drinks

### Firebase Collections

- **drinksScans**: Stores all drink redemption records with metadata
  - email: Guest email address
  - attendeeName: Name from Luma data
  - scannedAt: ISO timestamp
  - lumaVerified: Boolean flag
  - scanCount: Current redemption number (1-3)
  - remainingDrinks: Number of drinks left (0-2)
  - qrData: Original QR code data

### Luma Integration

- **Local Data**: Uses public/luma.json for guest lookup
- **Email Matching**: Case-insensitive email comparison
- **Event Validation**: Ensures guest is approved and registered
- **Status Checking**: Verifies approval status and check-in status

## Usage Instructions

### For Staff

1. Navigate to `/pos` page
2. Click "Start Scanning" button
3. Allow camera access when prompted
4. Point camera at attendee's QR code
5. Review redemption results and guest information
6. Check remaining drinks count
7. Click "Scan Another" to continue

### For Attendees

1. Navigate to main page
2. Enter email address
3. Generate QR code
4. Show QR code to staff for drink redemption

## Error Handling

- **Invalid QR Codes**: Shows error message for malformed data
- **Guest Not Found**: Clear message when email not in event
- **Network Issues**: Graceful handling of Firebase connection problems
- **Camera Access**: Clear instructions for camera permissions
- **Drink Limits**: Informative messages when limit is reached

## Security Features

- **Email Validation**: Ensures valid email format
- **Drink Tracking**: Prevents abuse through drink counting
- **Data Verification**: Cross-references with Luma event data
- **Audit Trail**: Complete logging of all drink redemptions

## Drink Tracking Logic

- **Initial Allocation**: 3 drinks per registered guest
- **Redemption Tracking**: Each scan reduces remaining count
- **Limit Enforcement**: No redemptions after 3 drinks used
- **Clear Display**: Shows remaining drinks prominently
- **History Tracking**: Complete record of all redemptions
